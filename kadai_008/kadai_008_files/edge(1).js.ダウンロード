(async()=>{const t=t=>Object.assign({v:1},t),e="send_event",n="event_res",o="send_customer",r="talk",i="cmp_status_changed",s="meta-changed",c="local",a="loc-changed",u="visibility-changed",l="ierr",d="visid-detected",h="ktid-detected",f="local_settings",v="request_optout",p="request_reset_visitor",m=t({name:"global-dispatcher",pub:[e,o,r,c,f,p],sub:[]}),w=t({name:"sender",pub:[n,s],sub:[e,u,i,h,d],storage:!0}),g=t({name:"ktid",pub:[h],sub:[]}),b=t({name:"detect",pub:[d],sub:[p],storage:!0}),_=t({name:"page-watcher",pub:[u,a],sub:[]}),y=t({name:"error-tracker",pub:[],sub:[l]}),k=t({name:"customer-db",pub:[],sub:[o,d,f,v]}),O=t({name:"krt_segments",pub:[],sub:[n,v],storage:!0}),S=t({name:"krt_plugin_user_identifier",pub:[e],sub:[]}),j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_",$=(t=15)=>{let e;return e=window.crypto?t=>crypto.getRandomValues(t):t=>[...Array(t.byteLength).keys()].map((()=>~~(63*Math.random()))),[...e(new Uint8Array(t))].map((t=>j[t%63])).join("")};const E=t=>N(t).toString(36),N=(t,e=5381,n=t.length)=>{for(;n;)e=33*e^t.charCodeAt(--n);return e>>>0},M="?",D={Edge:[/edg(?:[ea]?|ios)\/(\d+?)\./i],Opera:[/op(?:r|t)\/(\d+?)\./i],Firefox:[/f(?:irefox|xios)\/(\d+?)\./i],Chrome:[/c(?:hrome|rios|rmo)\/(\d+?)\./i],Safari:[/safari/i,/version\/(\d+?)\./i],IE:[/(?:msie\s|trident.+[:\s])(\d+?)\./i]},P={iPad:/ipad/i,iPhone:/iphone/i,Android:/android/i,Windows:/windows nt/i,"OS X":/os x \d+[._]\d+/i,Linux:/linux/i},T=t=>{const e=x(t);return{full:t,brand:e,version:C(t,e),platform:R(t)}},x=t=>{var e,n;return null!==(n=null===(e=Object.entries(D).find((([e,n])=>n.some((e=>e.test(t))))))||void 0===e?void 0:e[0])&&void 0!==n?n:M};function C(t,e){var n,o,r,i;return D[e]?null!==(o=null===(n=D[e].slice(-1)[0].exec(t))||void 0===n?void 0:n[1])&&void 0!==o?o:M:null!==(i=null===(r=t.match(/version[\\/ ](\d+?)\./i))||void 0===r?void 0:r[1])&&void 0!==i?i:M}const R=t=>{var e,n;return null!==(n=null===(e=Object.entries(P).find((([,e])=>e.test(t))))||void 0===e?void 0:e[0])&&void 0!==n?n:M},J=63072e3;function I(t,e,n,o,r=J,i=(t=>{document.cookie=t})){let s=`${`${encodeURIComponent(t)}=${encodeURIComponent(e)}`}; path=${o}; domain=${n}; max-age=${r}`;return"https:"===location.protocol&&(s+="; Secure"),i(s),q(t)===e}const U="=";function q(t,e=document.cookie){const n=e.split(/ *; */).find((e=>e.startsWith(t+U)));if(n)return n.split(U)[1]}function A(t,e,n,o){if(t){const r=K(t,e);if(r&&F(r,n,o))return r}return function(t,e,n){const o=t.split(".").reverse();let r=o.shift();for(const t of o)if(r=r?t+"."+r:t,F(r,e,n))return r;return t}(e,n,o)}const F=(t,e,n)=>{const o="REM"+Math.random().toString(32).substring(2);n(o,t,t,"/",1);const r=!!e(o);return n(o,"",t,"/",0),r},K=(t,e)=>{if(e.endsWith(t))return t},L=new Map,V=1;function W(t,e,n,o=V){const r=`${t}:${n}:${e}:v${o}`;if(L.has(r))return L.get(r);const i=z(r).toString(32);return L.set(r,i),i}const z=t=>{let e=t.length,n=5381;for(;e;)n=33*n^t.charCodeAt(--e);return n>>>0},B=t=>"0:"+W(H(t),t.unit,t.stats),G=t=>"tw:"+t,H=t=>`event.${t.event}.${t.path}`,Q=(t,e,n)=>{switch(e&&e(t),t[0]){case 14:{const[,,o]=t;Q(o,e,n);break}case 12:for(const o of Object.values(t[3]))Q(o,e,n);break;case 10:Q(t[4],e,n),Q(t[5],e,n)}n&&n(t)},X={},Y=(t,e,n)=>{var o;switch(t[0]){case 13:{const[,n,o]=t;if(null==e[o])throw Error("NotFound:"+o);const r=e[o];return et(r,n)||tt(r,n),r}case 14:{const[,,o]=t;return!Y(o,e,n)}case 11:return t[2];case 12:{const[,r,i,s]=t,c=null!==(o=X[i])&&void 0!==o?o:null==n?void 0:n[i];if(!c)throw Error("unknown api: "+i);const a=Object.entries(s).map((([t,o])=>[t,Y(o,e,n)])),u=c[0](Object.fromEntries(a));return et(u,c[1])||tt(u,c[1]),u}case 10:{const[,o,r,i,s,c]=t,a=Y(s,e,n),u=Y(c,e,n);return Z(a,i,u)}default:throw Error("unknown node kind")}},Z=(t,e,n)=>{switch(e){case 32:return t===n;case 33:return t!==n;case 34:return t<n;case 35:return t<=n;case 36:return t>n;case 37:return t>=n;case 30:return!(!t||!n);case 31:return!(!t&&!n);case 38:return RegExp(n).test(t);default:throw Error("unknown op")}},tt=(t,e)=>{throw Error(`Unexpected: ${JSON.stringify(t)}:  ${e}`)},et=(t,e)=>{const n=typeof t;switch(e){case 1:return"boolean"===n;case 2:return"number"===n;case 3:return"string"===n;default:return!0}},nt=(t,e)=>{if(!t.trigger)return()=>!0;const[n,o]=ot(t);let r=null;return(i,s)=>{if(null!==r&&s.size>0){if(!((t,e)=>{for(const n of e)if(t.has(n))return!0;return!1})(n,s))return r}return r=(n=>{const r={};for(const[t,e]of o){const o=n.get(e);if(null==o)return null;r[t]=o}return Y(t.trigger,r,e)})(i),!!r}},ot=t=>{const e=new Map,n=new Set,o=(t.trigger?(t=>{const e=[];return Q(t,(t=>{13===t[0]&&e.push(t)})),e})(t.trigger):[]).map((([,,t])=>t)),r=(t.values||[]).filter((t=>o.includes(t[2])));for(const[t,,o,i]of r){if(1===t){const t="1:"+H(i);e.set(o,t),n.add(t)}if(0===t){const t=B(i);e.set(o,t),n.add(t),n.add(G(i.unit)),i.aggr&&n.add(G(i.aggr))}}return[new Set(n),e]},rt=(t,e,n,o,r)=>{const i=new Map,s=st(t,r),[c,a,u]=it(t);if(e){const t=Date.now();for(const n of e.t){const o=e.u(n,t);i.set(n,o)}}return{l:t=>{const r=new Set;if(c.has(t.topic)){const n=((t,e)=>{const n=[],o=(t,e)=>{if("object"==typeof e&&null!==e)for(const[n,r]of Object.entries(e))o(`${t?t+".":""}${n}`,r);n.push([t,e])};return o(e,t),n})(t.payload,"event."+t.topic),s=n.filter((([t])=>a.has(t)));for(const[t,e]of s){const n="1:"+t;i.get(n)!==e&&(i.set(n,e),r.add(n))}const c=n.some((([t])=>u.has(t)));if(e&&c){const t=Date.now(),s=e.p(n);Promise.resolve(e.m(s)).catch(o).then((()=>{console.log("[dimension] write done",s)})),s.tw.forEach((t=>r.add(G(t)))),s.keys.forEach((t=>r.add((t=>"0:"+t)(t))));for(const n of e.t){const o=e.u(n,t);i.get(n)!==o&&(i.set(n,o),r.add(n))}}}return r.size>0&&n(r),t},p:(e=new Set)=>{const n=new Map;for(const r of t){const t=r._id;try{const o=s.get(t),r=!o||o(i,e);n.set(t,r)}catch(e){o(e),n.set(t,!1)}}return n}}},it=t=>{const e=new Set,n=new Set,o=new Set;for(const r of t)if(r.values)for(const t of r.values){const[r,,,i]=t;o.add(i.event);const s=H(i);1===r?e.add(s):n.add(s)}return[o,e,n]},st=(t,e)=>{const n=new Map;for(const o of t)n.set(o._id,nt(o,e));return n};class ct{constructor(t,e,n,o,r){this.g=t,this._=e,this.k=n,this.O=o,this.S=r,this.j=new Map,this.$=[]}gc(){var t,e;this.$=null!==(e=null===(t=this.k)||void 0===t?void 0:t.call(this,this.$))&&void 0!==e?e:this.$}ctx(t,e=[],n=[],o){const r=[];return{publish:(n,o)=>{var r;e.includes(n)||null===(r=this.S)||void 0===r||r.call(this,"pub",t,n),this.publish(n,o,{by:t})},subscribe:(e,i)=>{var s;n.includes(e)||null===(s=this.S)||void 0===s||s.call(this,"sub",t,e);const c=async(e,n)=>{n.by!==t&&await i(e,n)};c.owner=t;const a=this.subscribe(e,c,{context_name:t,custom_error_handler:o});r.push(a)},dispose(){for(const t of r)t()}}}dispose(){this.j.clear(),this.$=[]}publish(t,e,n={},o=Date.now()){var r,i;const s={topic:t,payload:e,metadata:Object.assign({timestamp:o,id:$(),by:"root"},n)},c=null!==(i=null===(r=this._)||void 0===r?void 0:r.call(this,s))&&void 0!==i?i:s,a=c.metadata.id;this.$.push(c);const u=this.j.get(t);if(!u)return a;for(const e of u)this.N(t,e.handler,c.payload,c.metadata,e.context);return a}subscribe(t,e,n){let o=this.j.get(t);o||(o=new Set,this.j.set(t,o));const r={handler:e,context:n};o.add(r);const i=this.$.filter((e=>e.topic===t));for(const o of i)this.N(t,e,o.payload,o.metadata,n);return()=>{o.delete(r)}}N(t,e,n,o,r){const i=(()=>{if(!r)return this.g;const t=r.custom_error_handler;return t||this.g})();try{this.O&&this.O(t,n,o.by,e.owner);const r=e(n,o);r instanceof Promise&&r.catch(i)}catch(t){i(t)}}}const at=Symbol();const ut=63072e6,lt=864e5,dt="at",ht=(t,e)=>{const n=t+"d";if(!(null==e?void 0:e.getItem(n)))try{null==e||e.setItem(n,"{}")}catch(t){}return(o,r,{enc:i=!0,shared:s=!0}={})=>{if(null==e)return;const c=i?E(o):o;try{if(s){const t=e.getItem(n),o=t?JSON.parse(t):{};o[c]=r,e.setItem(n,JSON.stringify(o))}else null==r?e.removeItem(t+c):e.setItem(t+c,JSON.stringify(r))}catch(t){}}},ft=(t,e)=>()=>{if(null!=e)try{for(const n of Object.keys(e))n.startsWith(t)&&e.removeItem(n)}catch(t){}},vt=(t,e)=>(...n)=>{if(null==e)return null;const o=[...n.map(E),...n],r=gt(e,t+"d")||{};for(const n of o){if(r[n])return r[n];const o=gt(e,t+n);if(null!=o)return o;const i=gt(e,n);if(null!=i)return i}return null},pt=t=>{const e=""+Math.random();try{t.setItem(e,"t");const n=t.getItem(e);return t.removeItem(e),"t"===n}catch(t){return!1}},mt=()=>{try{const t=window;if(pt(t.localStorage))return localStorage;if(pt(t.sessionStorage))return sessionStorage}catch(t){}};function wt(t,e=mt()){const n=ht(t,e),o=vt(t,e),r=ft(t,e),i=o(dt)*lt;if(i){if(Date.now()>i+ut&&e)for(const n of Object.keys(e))n.startsWith(t)&&e.removeItem(n)}return n(dt,Math.floor(Date.now()/lt),{enc:!1}),{get:o,set:n,clear:r}}const gt=(t,e)=>{const n=t.getItem(e);if(void 0===n)return null;try{return n?JSON.parse(n):null}catch(t){return"string"==typeof n?n:null}},bt="krt_edge_logger_enable";function _t(t,e,n=yt()){return{log:n?console.log:()=>{},error:e}}const yt=(t=window.localStorage||window.sessionStorage,e=location.hostname)=>{const n=null==t?void 0:t.getItem(bt);return null!=n&&(!![".test","localhost"].some((t=>e.endsWith(t)))||"true"===n)},kt="view",Ot="queue",St="tids";class jt{constructor(t,e,n){this.M=t,this.D=e,this.P=n}event(t,n={},o={}){null==n&&(n={}),n._system||(n._system={}),n._system.event_type="customtag";try{this.D.publish(e,{eventName:t,event_name:t,values:n,meta:o})}catch(t){this.P.error(t)}}set(t){(null==t?void 0:t.external_id)&&this.event("identify",{user_id:"wuid-ext-"+t.external_id},{})}local(t){try{this.D.publish(c,t)}catch(t){this.P.error(t)}}send(t,e={},n={}){this.event(t,e,n)}view(t={},e={}){this.event(kt,t,e)}customer(t={}){this.D.publish(o,t)}talk(t,...e){this.D.publish(r,{actionName:t,args:e})}local_settings(t,e){this.D.publish(f,{settingName:t,data:e})}renew_visitor_id(){this.D.publish(p,{})}getMainMeta(){return this.M.getMainMeta()}}function $t(t,e=window){e[t]||function(t,e=window){let n=e[t]=(...t)=>n.x?n.x.apply(0,t):n.q.push(t);n.q=[],n.i=Date.now(),n.allow=()=>{n.o="allow"},n.deny=()=>{n.o="deny"}}(t)}async function Et(t,e){const[n,...o]=e;if(!n||"string"!=typeof n)return;if(!(n in t))return void console.error(`[krt] unknown method: "${n}"`);const r=t[n].bind(t);return await r(...o)}const Nt="__KRT_DEVTOOLS__";function Mt(t){return"__KARTE_EDGE_"+t}function Dt(t,e,n=!0){!function(t,e=window){const n=Mt(t);if(e[n]||(e[n]={}),e[n].i){const e=`Duplicate edge.js (${t}) are loaded. Please check if more than one tag is embedded.`;throw console.error(e),Error(e)}e[n].i=!0}(t),n&&function(t=window){t[Nt]||(t[Nt]={enable:(t=!0)=>{localStorage.setItem(bt,JSON.stringify(t))}})}();const o=e||"krt";$t(o),function(t,e,n=window){const o=Mt(t);n[o]||(n[o]={}),n[o].n=e}(t,o)}const Pt=(t,e)=>n=>({_id:e.name,mode:"inline",impl:{default:t,config:e},pluginParams:n});function Tt(t,e,n=1){Math.random()<=n&&fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(console.error)}const xt={increment:()=>{},count:()=>{},distribution:()=>{}};class Ct{constructor(t=function(){const t=$(32),e=function(){const t=document.getElementsByTagName("meta"),e={};for(let n=0;n<t.length;n++){let o=t[n].getAttribute("name");o||(o=t[n].getAttribute("property")),o&&(e[o]=t[n].content)}return{title:e.title||e["og:title"],description:e.description||e["og:description"],keywords:e.keywords||e["og:keywords"],og_title:e["og:title"],og_description:e["og:description"],og_type:e["og:type"],og_image:e["og:image"],og_url:e["og:url"],og_keywords:e["og:keywords"],og_site_name:e["og:site_name"]}}();let n=function(){const t=document.getElementsByTagName("link");for(let e=0,n=t.length;e<n;e++){const n=t[e];if(n.rel&&"canonical"===n.rel.toLowerCase())return n.href}}();n||(n=null==e?void 0:e.og_url);return{original_pv_id:t,pv_id:t,referrer:document.referrer,title:document.title,url:location.href,canonical_url:n,og_url:null==e?void 0:e.og_url,og_image:null==e?void 0:e.og_image}}(),e={}){this.T=t,this.C=e}getMainMeta(){return this.T}getAllPluginMeta(){return this.C}getPluginMeta(t){return this.C[t]}updateMainMeta(t){this.T=Object.assign(Object.assign({},this.T),t)}updatePluginMeta(t,e){this.C[t]=Object.assign(Object.assign({},this.C[t]),e)}}const Rt=(t,e,n,o,r,i,s)=>{let c,a=!1;const u=new ct(o,(t=>{try{h.l(t)}catch(t){o(t)}return t}),void 0,At(e,r.meter)),l=It(u,(()=>c),o,r,i),d=((t,e,n,o,r)=>{const i=new Map,s=t=>{const n=t._id;if(i.has(n))return i.get(n);const r=e(t,o);return i.set(n,r),r},c=new Map,a=async t=>{const e=t._id;if(c.has(e))return;c.set(e,!0);const o=await s(t),r=n(t,o);r!==at&&c.set(e,r||!0)},u=t=>{if(!c.has(t))return;const e=c.get(t);e instanceof Function&&e(),c.delete(t)},l=t=>{null==r||r.increment("edgejs.core.plugin_loaded",{tags:t})};return{preload:()=>Promise.all(t.map((async t=>{var e,n,r;const i=t._id;try{if(t.preload||!t.trigger){const i=null!==(r=null!==(e=t.moduleUrl)&&void 0!==e?e:null===(n=t.impl)||void 0===n?void 0:n.name)&&void 0!==r?r:t._id;try{await s(t),l(["success:true","label:"+i])}catch(t){l(["success:false","label:"+i]),o(t)}}return i}catch(t){return i}}))),apply:e=>{var n,r,i;for(const[s,c]of e)if(void 0!==c){const e=t.find((t=>t._id===s));if(c){const t=null!==(i=null!==(n=e.moduleUrl)&&void 0!==n?n:null===(r=e.impl)||void 0===r?void 0:r.name)&&void 0!==i?i:e._id;a(e).then((()=>{l(["success:true","label:"+t])})).catch((n=>{l(["success:false","label:"+t]),o(n,{},{scope:e._id})}))}!1===c&&u(e._id)}}}})(t,Jt,l,o,r.meter);d.preload().catch(o);const h=rt(t,n,(t=>{if(null!=h)try{const e=h.p(t);d&&d.apply(e)}catch(t){o(t,{},{scope:"core:watch-tag"})}}),o,null==s?void 0:s.injectedTriggerBuiltinFns),f=()=>{try{if(a){const t=h.p();d.apply(t)}else{const e=qt(t,!1);d.apply(e)}}catch(t){o(t,{},{scope:"core:check"})}};return{source:u,run:t=>{a||(a=!0,c=t,f())},stop:()=>{a=!1;try{f()}catch(t){o(t,{},{scope:"core:stop"})}}}},Jt=async t=>{const e=t.script,n=t.moduleUrl;if(t.mode&&"inline"===t.mode){return t.impl}if(e){const t="data:text/javascript;charset=utf-8,"+encodeURIComponent(e);return await import(t)}return await import(n)},It=(t,e,n,o,r)=>(i,s)=>{const c=e();if(!c)return at;const a=((t,e,n,o,r,i,s)=>{let c;const a=(t,e={})=>{var i,s;r(t,e,{scope:null!==(s=null===(i=o.config)||void 0===i?void 0:i.name)&&void 0!==s?s:n._id})};if(o.config&&(null!=o.config.v&&1!==o.config.v&&console.error(`[edge:err]:1 plug:${o.config.v} `),o.config.storage&&o.config.name)){const n=o.config.name,i=Ut(e.apiKey,n);try{c=wt(i)}catch(t){r(t)}t.subscribe(v,(()=>{null==c||c.clear()}),{context_name:n,custom_error_handler:a})}const u=o.config?t.ctx(o.config.name||$(),o.config.pub,o.config.sub,a):t;return Object.assign(Object.assign({},e),{storage:c,logger:_t(0,r),meter:i.meter,params:n.pluginParams,handle_error:a,pubsub:u,pluginParams:n.pluginParams,base_urls:s})})(t,c,i,s,n,o,r);try{if(s.default)return s.default(a);throw Error("RunnerError:400")}catch(t){a.handle_error(t,{reason:"run"})}},Ut=(t,e)=>`krt@${t.slice(0,5)}.${e}$`,qt=(t,e)=>{const n=new Map;for(const o of t)n.set(o._id,e);return n},At=(t,e)=>{const n=[];return n.push(((t,e=3e3)=>{let n={};return setInterval((()=>{const e=n;n={},Object.values(e).forEach((e=>{t.count("edge.pubsub.fire_count",e.count,{tags:["topic:"+e.topic,"publisher:"+e.caller,"subscriber:"+e.callee]})}))}),e),(t,e,o,r)=>{const i=`${t}_${o}_${r||"NA"}`;n[i]?n[i].count++:n[i]={topic:t,caller:o,callee:r||"NA",count:1}}})(e)),(t,e,o,r)=>{n.forEach((n=>n&&n(t,e,o,r)))}},Ft=({pubsub:t,logger:e})=>(t.subscribe(l,(t=>{e.error(t.err,t.extras,t.tags,t.isForce)})),()=>{}),Kt="krt.vis",Lt="/";let Vt;function Wt(t="",e=void 0,n=document.domain,o=!0,r=q,i=I,s=wt(Bt(t))){if(o&&Vt)return Vt;const c=A(e,n,r,i),a=r(Kt),u=s.get(Kt);if(a&&u)return a!==u&&s.set(Kt,a,{enc:!1}),i(Kt,a,c,Lt),a;if(a&&!u)return s.set(Kt,a,{enc:!1}),a;if(!a&&u&&"string"==typeof u)return i(Kt,u,c,Lt),u;const l=$();try{i(Kt,l,c,Lt)}catch(t){}try{s.set(Kt,l,{enc:!1,shared:!1})}catch(t){}return Vt=l,l}function zt(t,e=void 0,n=document.domain,o=q,r=I,i=wt(Bt(t))){Vt=void 0;const s=A(e,n,o,r);try{r(Kt,"",s,Lt,0)}catch(t){}try{i.clear()}catch(t){}}function Bt(t){return`krt@${t.slice(0,5)}.detect$`}const Gt="krt.__ktid",Ht="/";async function Qt(t,e,n=void 0,o,r=q){const i=r(Gt);if(""===i&&function(t,e=document.domain,n=q,o=I){const r=A(t,e,n,o);o(Gt,"",r,Ht,0)}(n,document.domain),i)return Xt(t,e,void 0,n).catch((t=>(o(t),t))),i;return await Xt(t,e,n)}async function Xt(t,e,n=void 0,o=document.domain,r=q,i=I){const s=document.createElement("iframe"),c=await Promise.race([new Promise((t=>setTimeout((()=>t(void 0)),navigator.onLine?800:1500))),new Promise((n=>{window.addEventListener("message",(e=>{e.origin===t&&n(e.data.id)}),{once:!0,passive:!1}),s.src=`${t}?apikey=${e}`,s.style.display="none",document.head.appendChild(s)}))]);if(s.remove(),!c)return;const a=A(n,o,r,i);return i(Gt,c,a,Ht),c}const Yt=({pubsub:t,handle_error:e,logger:n,apiKey:o,params:r})=>{r.ktid_url&&(n.log("ktid:required"),Qt(r.ktid_url,o,r.domain,e).then((e=>{t.publish(h,{ktid:e})})).catch(e))},Zt=18e5,te="krt-customer.previousVisitTime";function ee(t){const{platform:e,brand:n}=t;let o;if(document.referrer){const{origin:t,href:e}=new URL(document.referrer);location.origin!==t&&(o=e)}const r=document.URL,i=function(t){try{const e=localStorage.getItem(te);localStorage.setItem(te,t.getTime()+"");const n=t.getTime()-new Date(Number(e)).getTime();return Zt>n?0:1}catch(t){return 0}}(new Date);let s,c;try{s=Intl.DateTimeFormat().resolvedOptions().timeZone,c=navigator.language||navigator.languages[0]}catch(t){}return{os:e,browser:n,referralUrl:o,webSessionCount:i,lastUrl:r,timezone:s,language:c}}const ne=async(t,e,n,o,r)=>{const i={visitor_id:t,api_key:e,data:n};return r&&n.userId&&(i.userToken=r),(async(t,e)=>{const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw await n.text()})(o+"/customer/v1/updateCustomer",i)};let oe=null;const re=({pubsub:t,visitorId:e,params:n,apiKey:r,ua:i})=>{let s=e;t.subscribe(d,(async t=>{s=t.visid,n.default_enabled&&await(async(t,e,n,o)=>{const r=ee(n);await ne(t,e,r,o)})(s,r,i,n.api_url)})),t.subscribe(o,(async t=>{s&&await ne(s,r,t,n.api_url,oe)})),t.subscribe(f,(t=>{"userToken"===t.settingName&&(oe={signature:t.data.signature,expiredAt:t.data.expiredAt})})),t.subscribe(v,(()=>{localStorage.removeItem(te)}))},ie=t=>(function(t,e,n,o,r,i=window){let s=null;try{s=i[t];const c=new jt(n,o,r);return s.x=async(...t)=>{try{return await Et(c,t)}catch(t){r.error(t)}},s.h=e||"no-hash",s.q||(s.q=[]),s.q.forEach((t=>{Et(c,t).catch((t=>{r.error(t)}))})),s.q=[],s}catch(t){r.error(t)}}(t.params.global,t.params.hash,t.eventMetaFunc,t.pubsub,t.logger),()=>{});const se=(t=document.head)=>{const e=t.querySelector('link[rel="canonical"]');if(e)return e.href},ce=t=>{const e=document.querySelector(`meta[property="${t}"]`);if(!e)return;return e.getAttribute("content")||void 0};class ae{constructor(t,e,n,o,r,i,s){this.R=t,this.J=e,this.I=n,this.P=o,this.U=r,this.A=i,this.F=s,this.K=!1,this._meta=ue(),this.U(this._meta)}send(t,e={},n={}){if(!t)return;null==e&&(e={});return de(t,e,this.F,this.A)?void 0:t===kt?this.L(e):this.V(t,e,n)}async L(t={},e={}){if(this.K){this.P.log("reset event main meta");const t=ue(this._meta);this._meta=t,this.U(t)}else this.K=!0;return t._system||(t._system={}),t._system.tag_name="edge",this.V(kt,t,e)}V(t,e,n={}){if(e.transaction_id){const t=this.J.get(St)||{},n=Date.now();if(t[e.transaction_id]){if(!(n-t[e.transaction_id]>18e5))return void this.P.log("[EventSender]","skip send event by duplicate transaction ids:"+e.transaction_id);delete t[e.transaction_id]}t[e.transaction_id]=Date.now(),this.J.set(St,Object.assign(Object.assign({},t),{[e.transaction_id]:Date.now()}))}const o={event_name:t,eventName:void 0,values:e,meta:Object.assign(Object.assign(Object.assign({},this._meta),n),{insert_id:$(32),local_date:Date.now()}),edge_meta:this.I()};try{this.R(le(o))}catch(t){this.P.error(t instanceof Error?t:Error("Unexpected Error happens, with "+t),{isForce:!0})}}}const ue=t=>{var e;const n=$(32),o=null!==(e=null==t?void 0:t.pv_id)&&void 0!==e?e:n,r=Object.assign(Object.assign({},function(t=document,e=location,n=screen){var o;const r=ce("og:url"),i=ce("og:image");return{referrer:t.referrer,title:t.title,url:e.href,canonical_url:null!==(o=se())&&void 0!==o?o:r,og_url:r,og_image:i,screen:{width:n.width,height:n.height}}}()),{pv_id:n,original_pv_id:o});return r},le=function(t){return JSON.parse(JSON.stringify(t,(function(t){const e=this[t];if(e instanceof Date){const t=Math.round(e.getTime()/1e3);return Number.isNaN(t)?null:t}return e instanceof Set?Array.from(e):e instanceof Map?Object.fromEntries(e.entries()):e})))},de=(t,e,n,o)=>{try{if(!o)return!1;if(!n.includes(t))return!1;const r=E(JSON.stringify(e));return r===o.get(t)||(o.set(t,r,{enc:!1}),!1)}catch(t){return!1}};class he extends Error{constructor(){super(...arguments),this.retryable=!0}}class fe extends Error{constructor(){super(...arguments),this.retryable=!0}}function ve(t){return 350}function pe(t){return 2**(t+10)}class me{constructor({action:t,onStatusChange:e,scheduler:n=ve,retryScheduler:o=pe,clock:r={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t)},logger:i,meter:s}){this.W=0,this.B=[],this.G=!1,this.H=!1,this.X=null,this.Y=t,this.Z=e,this.tt=n,this.et=o,this.nt=r,this.P=i,this.ot=s}async start(t=!1){if(this.H)return;this.H=!0,t&&this.B.length>0&&(this.G=!0,await this.rt(),this.G=!1);const e=async()=>{!this.G&&this.B.length>0?(this.W=0,this.G=!0,await this.rt(),this.G=!1):this.W+=1;const t=this.tt(this.W);this.X=this.nt.setTimeout((()=>{e().catch((t=>{this.P.error(t)}))}),t)};this.X=this.nt.setTimeout((()=>{e().catch((t=>{this.P.error(t)}))}),0)}stop(){this.X&&this.nt.clearTimeout(this.X),this.H=!1}pushEvent(...t){return this.B.push(...t),this.G&&this.P.log("[retransmission] enter waiting queue",t),this.Z(this.B)}async rt(){const t=this.B.slice(0,20),e=t.length;return await this.it(t),this.B=this.B.slice(e),this.Z(this.B)}async it(t,e=0){try{await this.Y(t),this.P.log("[retransmission] sent",t.length,"left queue: ",this.B.length-t.length),this.ot.increment("edgejs.sender.done")}catch(n){if(this.P.log("[retransmission] error",n,"left queue:",this.B.length-t.length,"retryCount:",e),n.retryable&&e<6){const n=this.et(e);await new Promise((t=>this.nt.setTimeout(t,n))),await this.it(t,e+1)}}}get st(){return this.B.length}}const we="ntvsync",ge="__karte_ntvsync";class be{constructor(t,e,n=!1){this.ct=t,this.J=e,this.ut=n,this.lt=()=>{const t=this.dt();if(null==t?void 0:t.ts){const e=t.ts+60;if((new Date).getTime()/1e3>e)return this.ct(Error("_k_ntvsync parameter is expired.")),null}return t&&this.ht(t),t},this.lt()}ht(t){var e;null===(e=this.J)||void 0===e||e.set(we,encodeURIComponent(JSON.stringify(t)))}ft(){var t;try{return JSON.parse(decodeURIComponent(null===(t=this.J)||void 0===t?void 0:t.get(we)))}catch(t){this.ct(t)}return null}isDisabled(){return null===this.ft()}dt(){if(window[ge])return delete window[ge].ts,window[ge];if(!this.ut)return null;const t=new URLSearchParams(window.location.search.substring(1)).get("_k_ntvsync_b");if(t){const e=atob(decodeURIComponent(t));return JSON.parse(e)}return null}getParameter(){return this.ft()}}const _e=({pubsub:t,apiKey:o,visitorId:r,handle_error:i,logger:c,meter:a,storage:l,eventMetaFunc:f,params:v})=>{let p=r,m=!0!==v.ktid,w=!1;const g=()=>{m&&w&&p?setTimeout((()=>{S.start().catch(i)}),0):S.stop()};let b;const _=f,y=new be(i,l,v.webviewQueryParsing),k=(t,e,n)=>{a.distribution(t,n,{tags:["hasAction:"+(e.actions.length>0),"done:"+e.done]})};let O=!0;const S=new me({action:async e=>{if(0===e.length)return void c.log("skip: no events");const r=e.map((t=>{const{eventName:e,event_name:n}=t,o=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(t,["eventName","event_name"]);return Object.assign({event_name:n||e},o)}));if(!m||!p)throw Error("Not ready");const i={api_key:o,visitor_id:p,meta:{},events:r,new_visitor_id:b},s=y.getParameter();s&&(c.log("[sender] native_app_sync",s),i.new_visitor_id=s.visitor_id,i.app_info=s.app_info);const u=v.event_url;c.log("[sender] sending...",i.events.length),a.increment("edgejs.sender.send_request");const l=performance.now(),d=await(async(t,e)=>{let n;try{n=await fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},body:JSON.stringify(e)})}catch(t){throw new fe(t)}if(n.status>=500)throw new he("Failed to request: "+await n.text());if(!n.ok)throw Error("Failed to request: "+await n.text());return await n.json()})(u,i),h=performance.now(),f=Date.now();k("edgejs.sender.event",d,h-l);!!v.startup_epoch&&O&&r.some((t=>t.event_name===kt))&&(k("edgejs.sender.firstView",d,f-v.startup_epoch),O=!1),t.publish(n,{req:i,res:d})},onStatusChange:t=>{const e=Date.now(),n=t.filter((t=>{var n;return(null===(n=t.meta)||void 0===n?void 0:n.local_date)&&e-t.meta.local_date<864e5}));try{l.set(Ot,n)}catch(t){i(t)}},logger:c,meter:a});if(!0===v.webviewOnly&&y.isDisabled())return c.log("[webviewOnly detected]"),S.stop();for(const t of l.get(Ot)||[])S.pushEvent(t);t.subscribe(d,(t=>{p=t.visid,g()})),t.subscribe(u,(t=>{w="visible"===t.state,g()}));const j=new ae((t=>S.pushEvent(t)),l,(()=>_.getAllPluginMeta()),c,(e=>{t.publish(s,e),_.updateMainMeta(e)}),wt(`krt@${o.slice(0,5)}.skip_dup$`,window.sessionStorage),Array.isArray(v.skip_dup)?v.skip_dup:[]);return t.subscribe(e,(async(t,e)=>j.send(t.event_name||t.eventName,t.values,t.meta))),t.subscribe(h,(t=>{b=t.ktid,m=!0,g()})),w=!0,g(),()=>{S.stop()}},ye=({pubsub:t,storage:e,apiKey:o})=>{const r=`krt.${o}.segments`;return t.subscribe(n,(t=>{var n;if(null!=(null===(n=t.res)||void 0===n?void 0:n.segment_ids)){null==e||e.set("segments",t.res.segment_ids,{enc:!1,shared:!1});try{const e={expire:!1,last:(new Date).getTime(),val:t.res.segment_ids};localStorage.setItem(r,JSON.stringify(e))}catch(t){}}})),t.subscribe(v,(()=>{localStorage.removeItem(r)})),()=>{}},ke=({pubsub:t})=>{const n=new URLSearchParams(window.location.search),o=/\_k\_(\S+)\_uid/;for(const[r,i]of n.entries())if(r.match(o)){const n=r.match(o)[1];n&&t.publish(e,{event_name:`plugin_${n}_identify`,values:{encrypted_user_id:i}})}return()=>{}},Oe=({pubsub:t,globalName:e})=>{const n=e=>{const n=new URL(e),o=["href","host","pathname","search","hash","origin"].reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:n[e]})),{});o.originpath=`${n.origin}${n.pathname}`,t.publish(a,{url:o,at:Date.now()})};let o=location.href;const r=()=>{o!==location.href&&(o=location.href,n(o))},i=window[e];i&&(i._kick=r);const s=new MutationObserver(r);s.observe(document.head,{childList:!0,subtree:!0}),window.addEventListener("popstate",r),n(o);const c=(t=>{let e=Date.now(),n=Date.now();const o=()=>{const o=document.visibilityState;"visible"===o?(e=Date.now(),t({state:o,elapsed:e-n})):"hidden"===o&&(n=Date.now(),t({state:o,elapsed:n-e}))};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)})((e=>{t.publish(u,e)}));return()=>{s.disconnect(),window.removeEventListener("popstate",r),c()}};function Se({params:t,apiKey:e,storage:n}){return Wt(e,t.domain,document.domain,!0,void 0,void 0,n)}const je=Pt((({pubsub:t,params:e,apiKey:n,storage:o})=>{t.subscribe(p,(()=>{const r=function(t){const{params:e,apiKey:n,storage:o}=t;return zt(n,e.domain,document.domain,void 0,void 0,o),Se(t)}({params:e,apiKey:n,storage:o});t.publish(d,{visid:r})}));const r=Se({params:e,apiKey:n,storage:o});t.publish(d,{visid:r})}),b),$e=Pt(Ft,y),Ee=Pt(ie,m),Ne=Pt(_e,w),Me=Pt(re,k),De=Pt(Oe,_),Pe=Pt(Yt,g),Te=Pt(ye,O),xe=Pt(ke,S);var Ce,Re,Je,Ie,Ue,qe,Ae,Fe,Ke,Le;const Ve={"configVersion":1,"apiKey":"35a3029ea60b35969a365403fd4c9a6c","globalName":"krt","edgeScripts":[{"_id":"63374d8d9349130012cca5ac","moduleUrl":"https://cdn-edge.karte.io/__edge_plugins/context_event/index.js","pluginParams":{"customTag":"(function(_karte_tracker){  _karte_tracker.trackAutoPageGroup({});_karte_tracker.getItemInfo();_karte_tracker.trackCustomClickOrDisplayed({\"urlCondition\":{\"compares\":\"default_equal\",\"url\":{\"isRegex\":true,\"value\":\"https://lp.sejuku.net/seminar/.*|https://lp.sejuku.net/calendar_.*\"},\"queries\":[]},\"auto_page_groups\":[],\"query_selector\":\".pro_entry\",\"text_value\":\"\",\"user_action\":\"click\",\"event_name\":\"63cf7ed717b9c1001236daea\"}, '63cf7ed717b9c1001236daea');_karte_tracker.trackActionMode();_karte_tracker.trackVisibilityChange();_karte_tracker.trackActivityChange();}(contextEventTracker));"},"trigger":[],"values":[]},{"_id":"63374d909349130012cca5af","moduleUrl":"https://cdn-edge.karte.io/__edge_plugins/blitz_action_runner/index.js","pluginParams":{"spaMode":true},"trigger":[],"values":[]}],"installedEdgeTag":true,"bundle":false,"optInOutMode":false,"requireNativeBuild":false,"domain":{"useKtid":false,"domainName":""},"eventSettings":{"isDisabledAuto":false,"eventsNotToSendDuplicate":[]},"customerDBSettings":{"isEnabledSendDefaultCustomerData":false},"webview":{"webviewOnly":false,"isEnabledQueryParsing":false}},We=Ve.edgeScripts,ze=Ve.apiKey,Be=!!(null===(Ce=Ve.domain)||void 0===Ce?void 0:Ce.useKtid),Ge=null===(Re=Ve.domain)||void 0===Re?void 0:Re.domainName,He=!!(null===(Je=Ve.webview)||void 0===Je?void 0:Je.webviewOnly),Qe=!!(null===(Ie=Ve.webview)||void 0===Ie?void 0:Ie.isEnabledQueryParsing),Xe=null===(Ue=Ve.eventSettings)||void 0===Ue?void 0:Ue.isDisabledAuto,Ye=null===(qe=Ve.eventSettings)||void 0===qe?void 0:qe.eventsNotToSendDuplicate,Ze=Ve.installedEdgeTag,tn=!!(null===(Ae=Ve.customerDBSettings)||void 0===Ae?void 0:Ae.isEnabledSendDefaultCustomerData),en=Ve.activeIdRate,nn=!!Ve.optInOutMode,on=Ve.monitoringRate,rn=Ve.base_urls,sn=Ve.globalName,cn={"cdn-edge.karte.io":"https://cdn-edge.karte.io","b.karte.io":"https://b.karte.io","edge-api.karte.io":"https://edge-api.karte.io","action-table.karte.io":"https://action-table.karte.io","ktid.karte-edge.io":"https://ktid.karte-edge.io","client-log.karte.io":"https://client-log.karte.io"};rn&&Object.assign(cn,rn);const an={firstViewDisabled:Xe,webViewOnly:He},un={injectedTriggerBuiltinFns:{},target:"web"};if(null===document||void 0===document?void 0:document.currentScript){const t=document.currentScript.getAttribute("data-options");if(t)try{const e=JSON.parse(t);an.firstViewDisabled=!!e.firstViewDisabled,an.webViewOnly=!!e.webViewOnly}catch(t){}}const ln=(null===(Fe=window.karte_tracker_names)||void 0===Fe?void 0:Fe.length)>0?window.karte_tracker_names[0]:"tracker",dn=!an.firstViewDisabled&&"function"!=typeof(null===(Ke=window[ln])||void 0===Ke?void 0:Ke.init),hn=[je({domain:Ge}),$e({url:cn["client-log.karte.io"]?cn["client-log.karte.io"]+"/sentry/notify":""}),De({}),Ee({global:sn,hash:"03981e4"}),Ne({ktid:Be,event_url:cn["b.karte.io"]+"/event",skip_dup:Ye,webviewOnly:an.webViewOnly,webviewQueryParsing:Qe,startup_epoch:dn?null===(Le=window[sn])||void 0===Le?void 0:Le.i:void 0}),Me({default_enabled:tn,api_url:cn["edge-api.karte.io"]}),Te({}),xe({}),...We];Be&&hn.push(Pe({ktid_url:cn["ktid.karte-edge.io"],domain:Ge}));for(const t of hn)t.trigger&&0===t.trigger.length&&(t.trigger=void 0),t.values&&0===t.values.length&&(t.values=void 0),t.params=t.pluginParams;const fn=document.cookie.split("; ").some((t=>t.startsWith("krt_oo=")));try{const t=window[sn];t&&(t.b="1.8.59",t.c="1.8.4")}catch(t){}(()=>{if(fn)return;const t=((t,e,n,o,r=.1)=>(i,s,c,a)=>{if(!(i instanceof Error))return;if(["Failed to fetch","Window.fetch","Load failed","Importing"].some((t=>i.message.startsWith(t))))return;if(navigator.userAgent.includes("HeadlessChrome"))return;const u={serializedError:{name:i.name,stack:i.stack,message:i.message,code:i.code},extras:Object.assign(Object.assign({},s),{stack:i.stack,hash:n,href:location.href,ua:navigator.userAgent,env:t}),tags:Object.assign(Object.assign({},null!=c?c:{}),e)};o&&(Math.random()<r||a)&&fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(console.error)})("production",{api_key:ze,target:un.target},"03981e4",cn["client-log.karte.io"]?cn["client-log.karte.io"]+"/sentry/notify":""),n=function(t,e={sampleRate:.005,tags:[]}){return!t||Math.random()>(e.sampleRate||.005)?xt:{increment(t,e){this.count(t,1,e)},count(n,o,r){Tt(t,{interval:60,metric:n,points:[[Date.now()/1e3,o]],tags:[...new Set([...e.tags||[],...(null==r?void 0:r.tags)||[]])],type:"count"})},distribution(n,o,r){Tt(t,{interval:60,metric:n,points:[[Date.now()/1e3,o]],tags:[...new Set([...e.tags||[],...(null==r?void 0:r.tags)||[]])],type:"distribution"})}}}(cn["client-log.karte.io"]+"/dd/metrics",{sampleRate:on,tags:["api_key:"+ze]}),o=o=>{let r;r=Rt(hn,ze,o,t,{meter:n},cn,un),dn&&r.source.publish(e,{eventName:"view",event_name:"view"});let i=!1;const s=()=>{Ze||null!=window.__EDGE_DEMO||(async(t,e,n)=>{(async()=>{const o=await fetch(n+"/customer/v1/markInstalledEdgeTagFlag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:t,visitor_id:e})});if(!o.ok)throw Error(await o.text())})().catch(console.error)})(ze,"mkr",cn["edge-api.karte.io"]);const t=Wt(ze,Ge);if((!en||function(t,e){return t.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0)%32/32<e}(t,en))&&!i){const e=((t,e,n,o,r=navigator.userAgent)=>{const i=new Ct;return{apiKey:t,ua:T(r),v:1,env:"production",meta:i,target:o.target,idgen:$,hash:E,globalName:e,visitorId:n,eventMetaFunc:i}})(ze,sn,t,un);r.run(e),i=!0}},c=()=>{i&&(r.stop(),r.source.dispose(),zt(ze,Ge),i=!1)};nn?(function(t,e,n,o=window){const r=o[n],i=()=>{t.source.publish("request_optin",{}),r.q=[],e()};"allow"===r.o&&i(),r.allow=i}(r,s,sn),function(t,e,n,o=window){const r=o[n];"deny"===r.o&&(t.source.publish(v,{}),e()),r.deny=()=>{t.source.publish(v,{}),e()}}(r,c,sn)):s()};try{Dt(ze,sn,!nn),o()}catch(e){t(e)}})()})();
